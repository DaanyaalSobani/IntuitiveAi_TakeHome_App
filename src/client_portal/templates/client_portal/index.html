{% extends 'client_portal/base.html' %}
{% block head_title %}Client Portal{% endblock %}
{% block extra_head %}
    {% load static %}
    <link rel="stylesheet" href="{% static 'client_portal/style.css' %}">
{% endblock %}
{%block content %}
    <div class="container" id="main-container">
        <div class="row">
            <div class="col-3" id="left-panel">
                Hi
            </div>
            <div class="col-9" id="right-panel">
                <h3>Calibrate</h3>
                <div class="card">
                  <div class="card-body">
                    Progress Bar will go here.
                  </div>
                </div>
               <div class="card" id="system-preferences">
                  <div class="card-body row">

                  </div>
                </div>
            </div>
        </div>

    </div>
{% endblock %}
{% block extra_body %}
    <script src="{% static 'client_portal/item_card.js'%}"></script>
    <script>
        state = {
            Recyclable_count: 0,
            Paper_count: 0,
            Landfill_count: 0,
            Compost_count: 0,
        }
        preferences = [{
                            name: "Recyclable",
                            color: "red"
                        },
                        {
                            name: "Paper",
                            color: "yellow"
                        },
                        {
                            name: "Landfill",
                            color: "black"
                        },
                        {
                            name: "Compost",
                            color: "green"
                        }]
        get_trash((res) =>{
            update_trash_state(res.trash)
            preferences.forEach(elem => {
                id = "preference_box_" + elem.name
                $("#system-preferences").children(".card-body").append(`
                    <div class='col-3' id='${id}'></div>
                `).css("text-align","center")
                itemCard($("<div></div>").appendTo(`#${id}`),state[`${elem.name}_count`],elem.color)
                $(`#${id}`).append(`<h5>${elem.name}</h5>`)
            })
        })

        function update_trash_state(trash) {
            counter = {}
            trash.forEach(e => {
                if(!counter.hasOwnProperty(e.type)){
                    counter[e.type] = 1
                }else{
                    counter[e.type] =  counter[e.type] + 1
                }
            })
            state['Recyclable_count'] = counter['R'] || 0
            state['Landfill_count'] = counter['L'] || 0
            state['Paper_count'] = counter['P'] || 0
            state['Compost_count'] = counter['C'] || 0
        }


    </script>
{% endblock %}